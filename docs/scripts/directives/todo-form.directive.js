angular.module('todoApp').directive('todoForm',function(){return{restrict:'E',scope:{todo:'=?',mode:'@'},templateUrl:'scripts/directives/todo-form.template.html',controller:function($scope,storage,$routeParams,$location){$scope.todo=angular.isUndefined($scope.todo)?{}:$scope.todo;if(angular.isDefined($scope.todo)){$scope.todo.date=new Date($scope.todo.date)};$scope.todoClone=angular.copy($scope.todo);$scope.$routeParams=$routeParams;$scope.priorityOptions=[{type:'Very High',value:5},{type:'High',value:4},{type:'Medium',value:3},{type:'Low',value:2},{type:'Very Low',value:1}];$scope.statusOptions=[{type:'Open',value:1,glyph:'glyphicon-play-circle'},{type:'In progress',value:2,glyph:'glyphicon-time'},{type:'Completed',value:3,glyph:'glyphicon-ok'}];$scope.dateOptions={formatYear:'yy',minDate:new Date(),startingDay:1};$scope.openCalendar=function(){$scope.calendar.opened=true;};$scope.calendar={opened:false};$scope.addTodo=function(todo){todo.id=Date.now();storage.insert(todo).then(function(res){$scope.todos=res;$scope.todo={};$location.path('/');});};$scope.updateTodo=function(todo){todo.id=$scope.todoClone.id;storage.updateTodo(todo).then(function(){$location.path('/');});};$scope.submitForm=function(isValid,todo){if(angular.isUndefined(todo.status))todo.status=$scope.statusOptions[0].value.toString();if(angular.isUndefined(todo.priority))todo.priority=$scope.priorityOptions[2].value.toString();if(isValid&&$scope.mode==='edit')$scope.updateTodo(todo);if(isValid&&$scope.mode==='new')$scope.addTodo(todo);}}};});